<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineRate</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* â”€â”€ Reset & tokens â”€â”€ */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #0d0d0d;
            --surface: #161616;
            --line: #1f1f1f;
            --line2: #2a2a2a;
            --text: #ececec;
            --sub: #6e6e6e;
            --acc: #d4a849;
            --acc-dim: rgba(212, 168, 73, .12);
            --r: 10px;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--line2);
            border-radius: 2px;
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        /* â”€â”€ Header â”€â”€ */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 0 32px;
            height: 56px;
            background: rgba(13, 13, 13, .92);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--line);
        }

        .logo {
            font-size: 15px;
            font-weight: 600;
            letter-spacing: -.01em;
            color: var(--text);
            flex-shrink: 0;
        }

        .logo span {
            color: var(--acc);
        }

        .type-switch {
            display: flex;
            gap: 2px;
            background: var(--surface);
            border-radius: 8px;
            padding: 3px;
        }

        .tt {
            padding: 5px 14px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            color: var(--sub);
            background: transparent;
            font-family: 'Inter', sans-serif;
            transition: all .15s;
        }

        .tt.on {
            background: var(--line2);
            color: var(--text);
        }

        .name-field {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .name-field input {
            background: transparent;
            border: none;
            outline: none;
            color: var(--text);
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            width: 100px;
            text-align: right;
        }

        .name-field input::placeholder {
            color: var(--sub);
        }

        .av {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--acc);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: #000;
            flex-shrink: 0;
        }

        main {
            max-width: 1280px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        .page-layout {
            display: flex;
            gap: 28px;
            align-items: flex-start;
        }

        .main-col {
            flex: 1;
            min-width: 0;
        }

        .sidebar {
            width: 240px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
            position: sticky;
            top: 72px;
        }

        .sidebar-card {
            background: var(--surface);
            border: 1px solid var(--line);
            border-radius: var(--r);
            overflow: hidden;
        }

        .sidebar-hd {
            padding: 10px 14px;
            border-bottom: 1px solid var(--line);
            font-size: 10px;
            font-weight: 600;
            letter-spacing: .06em;
            text-transform: uppercase;
            color: var(--sub);
        }

        .sb-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 14px;
            border-bottom: 1px solid var(--line);
            cursor: pointer;
            transition: background .15s;
        }

        .sb-item:last-child {
            border-bottom: none;
        }

        .sb-item:hover {
            background: var(--line);
        }

        .sb-rank {
            font-size: 11px;
            font-weight: 700;
            color: var(--sub);
            width: 14px;
            text-align: center;
            flex-shrink: 0;
        }

        .sb-thumb {
            width: 28px;
            height: 42px;
            border-radius: 3px;
            object-fit: cover;
            background: var(--line);
            flex-shrink: 0;
        }

        .sb-thumb-ph {
            width: 28px;
            height: 42px;
            border-radius: 3px;
            background: var(--line);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }

        .sb-info {
            flex: 1;
            min-width: 0;
        }

        .sb-title {
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sb-sub {
            font-size: 10px;
            color: var(--sub);
            margin-top: 1px;
        }

        .sb-score {
            font-size: 12px;
            font-weight: 700;
            color: var(--acc);
            flex-shrink: 0;
        }

        /* â”€â”€ Stats row â”€â”€ */
        .stats {
            display: flex;
            gap: 1px;
            background: var(--line);
            border: 1px solid var(--line);
            border-radius: var(--r);
            overflow: hidden;
            margin-bottom: 36px;
        }

        .stat {
            flex: 1;
            padding: 16px 20px;
            background: var(--surface);
        }

        .stat-v {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -.02em;
        }

        .stat-l {
            font-size: 11px;
            color: var(--sub);
            margin-top: 1px;
            letter-spacing: .02em;
            text-transform: uppercase;
        }

        .toolbar {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
        }

        .search-wrap {
            flex: 1;
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--sub);
            font-size: 14px;
            pointer-events: none;
        }

        .search-wrap input {
            width: 100%;
            padding: 9px 12px 9px 36px;
            background: var(--surface);
            border: 1px solid var(--line2);
            border-radius: var(--r);
            color: var(--text);
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: border-color .15s;
        }

        .search-wrap input::placeholder {
            color: var(--sub);
        }

        .btn {
            padding: 9px 16px;
            border-radius: var(--r);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .15s;
            border: 1px solid var(--line2);
            background: var(--surface);
            color: var(--text);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            border-color: var(--line2);
            background: var(--line2);
        }

        .btn-primary {
            background: var(--acc);
            color: #000;
            border-color: transparent;
        }

        .btn-primary:hover {
            background: #c49a38;
        }

        .filter-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 20px;
        }

        .filter-sel,
        .sort-sel {
            background: var(--surface);
            border: 1px solid var(--line2);
            border-radius: var(--r);
            padding: 7px 10px;
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            cursor: pointer;
            outline: none;
        }

        .filter-sel {
            flex: 1;
        }

        /* Genre Tag Picker */
        .tag-picker-wrap {
            border: 1px solid var(--line);
            border-radius: 8px;
            background: var(--bg);
            position: relative;
        }

        .tag-picker-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            padding: 7px 8px;
            min-height: 38px;
            cursor: pointer;
        }

        .tag-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 7px;
            background: var(--acc-dim);
            border: 1px solid rgba(212, 168, 73, .35);
            border-radius: 4px;
            font-size: 12px;
            color: var(--acc);
        }

        .tag-pill button {
            background: none;
            border: none;
            color: var(--acc);
            font-size: 11px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            opacity: .7;
        }

        .tag-pill button:hover {
            opacity: 1;
        }

        .tag-placeholder {
            font-size: 13px;
            color: var(--sub);
            padding: 2px 4px;
        }

        .tag-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--surface);
            border: 1px solid var(--line2);
            border-radius: 8px;
            overflow: hidden;
            max-height: 180px;
            overflow-y: auto;
            z-index: 50;
            display: none;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .4);
        }

        .tag-dropdown.open {
            display: block;
        }

        .tag-opt {
            padding: 8px 12px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background .1s;
        }

        .tag-opt:hover {
            background: var(--line);
        }

        .tag-opt.sel {
            color: var(--acc);
        }

        .tag-opt.sel::before {
            content: 'âœ“';
            font-size: 11px;
            width: 11px;
        }

        .tag-opt:not(.sel)::before {
            content: '';
            display: inline-block;
            width: 11px;
        }

        /* â”€â”€ Film grid â”€â”€ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
        }

        .card {
            border-radius: var(--r);
            overflow: hidden;
            cursor: pointer;
            transition: transform .2s;
            background: var(--surface);
            border: 1px solid var(--line);
        }

        .card:hover {
            transform: translateY(-3px);
            border-color: var(--line2);
        }

        .poster-wrap {
            aspect-ratio: 2/3;
            overflow: hidden;
            background: var(--line);
            position: relative;
        }

        .poster-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform .3s;
        }

        .card:hover .poster-wrap img {
            transform: scale(1.03);
        }

        .poster-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--line2);
            font-size: 36px;
        }

        .card-body {
            padding: 12px;
        }

        .card-title {
            font-size: 13px;
            font-weight: 600;
            letter-spacing: -.01em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }

        .card-sub {
            font-size: 11px;
            color: var(--sub);
            margin-bottom: 8px;
        }

        .card-meta {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .score {
            font-size: 12px;
            font-weight: 600;
            color: var(--acc);
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .score-star {
            font-size: 11px;
        }

        .rater-row {
            display: flex;
            gap: -3px;
        }

        .rater-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 1.5px solid var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: 700;
            color: #fff;
            margin-right: -4px;
        }

        /* â”€â”€ Detail overlay â”€â”€ */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .6);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .overlay.hidden {
            display: none;
        }

        .detail-panel {
            background: var(--surface);
            border: 1px solid var(--line);
            border-radius: 14px;
            width: 100%;
            max-width: 680px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Detail top */
        .d-top {
            display: flex;
            gap: 20px;
            padding: 24px;
            border-bottom: 1px solid var(--line);
        }

        .d-poster {
            width: 90px;
            height: 135px;
            border-radius: 7px;
            object-fit: cover;
            background: var(--line);
            flex-shrink: 0;
        }

        .d-poster-ph {
            width: 90px;
            height: 135px;
            border-radius: 7px;
            background: var(--line);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--line2);
        }

        .d-info {
            flex: 1;
            min-width: 0;
        }

        .d-title {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -.02em;
            margin-bottom: 4px;
        }

        .d-meta {
            font-size: 12px;
            color: var(--sub);
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .d-genres {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .g-pill {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            background: var(--line);
            color: var(--sub);
        }

        .d-ov {
            font-size: 13px;
            color: var(--sub);
            line-height: 1.65;
            max-height: 60px;
            overflow: hidden;
            transition: max-height .3s;
        }

        .d-ov.exp {
            max-height: 300px;
        }

        .expand-btn {
            background: none;
            border: none;
            color: var(--acc);
            font-size: 12px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            padding: 4px 0;
        }

        .close-btn {
            margin-left: auto;
            background: none;
            border: 1px solid var(--line2);
            border-radius: 6px;
            width: 28px;
            height: 28px;
            cursor: pointer;
            color: var(--sub);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            align-self: flex-start;
            transition: all .15s;
        }

        .close-btn:hover {
            color: var(--text);
            background: var(--line2);
        }

        /* Detail body */
        .d-body {
            padding: 24px;
        }

        .section-label {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: .06em;
            text-transform: uppercase;
            color: var(--sub);
            margin-bottom: 12px;
        }

        /* Avg block */
        .avg-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .avg-num {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -.04em;
            color: var(--text);
            line-height: 1;
        }

        .avg-stars {
            display: flex;
            gap: 2px;
            margin-top: 4px;
        }

        .avg-count {
            font-size: 11px;
            color: var(--sub);
            margin-top: 3px;
        }

        .bar-list {
            flex: 1;
            min-width: 120px;
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .bar-label {
            font-size: 11px;
            color: var(--sub);
            width: 10px;
            text-align: right;
        }

        .bar-track {
            flex: 1;
            height: 3px;
            background: var(--line);
            border-radius: 2px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: var(--acc);
            border-radius: 2px;
            transition: width .4s;
        }

        .bar-count {
            font-size: 11px;
            color: var(--sub);
            width: 14px;
        }

        /* Ratings list */
        .r-list {
            display: flex;
            flex-direction: column;
            gap: 1px;
            margin-bottom: 24px;
            border: 1px solid var(--line);
            border-radius: var(--r);
            overflow: hidden;
        }

        .r-entry {
            display: flex;
            gap: 12px;
            padding: 14px 16px;
            background: var(--surface);
            border-bottom: 1px solid var(--line);
        }

        .r-entry:last-child {
            border-bottom: none;
        }

        .r-av {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            flex-shrink: 0;
        }

        .r-name {
            font-size: 13px;
            font-weight: 600;
        }

        .r-stars {
            display: flex;
            gap: 2px;
            margin-top: 1px;
        }

        .r-star {
            font-size: 12px;
            color: var(--line2);
        }

        .r-star.on {
            color: var(--acc);
        }

        .r-date {
            font-size: 11px;
            color: var(--sub);
            margin-top: 2px;
        }

        .r-review {
            font-size: 12px;
            color: var(--sub);
            margin-top: 5px;
            line-height: 1.6;
        }

        /* Add review */
        .add-box {
            border: 1px solid var(--line);
            border-radius: var(--r);
            padding: 18px;
        }

        .add-box h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 14px;
        }

        /* Half-star picker */
        .star-picker {
            display: flex;
            gap: 2px;
            margin-bottom: 14px;
        }

        .star-slot {
            position: relative;
            width: 30px;
            height: 30px;
            cursor: pointer;
        }

        .star-slot .s-bg {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: var(--line2);
            transition: color .1s;
            user-select: none;
        }

        .star-slot .s-fill {
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: var(--acc);
            transition: width .1s;
            user-select: none;
            height: 100%;
        }

        .star-slot .s-left {
            position: absolute;
            left: 0;
            top: 0;
            width: 50%;
            height: 100%;
            z-index: 2;
        }

        .star-slot .s-right {
            position: absolute;
            right: 0;
            top: 0;
            width: 50%;
            height: 100%;
            z-index: 2;
        }

        /* Sync status + setup banner */
        .sync-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--sub);
            flex-shrink: 0;
        }

        .sync-dot.ok {
            background: #4ade80;
        }

        .sync-dot.err {
            background: #f87171;
        }

        .sync-dot.spin {
            animation: pulse .9s infinite;
            background: var(--acc);
        }

        @keyframes pulse {
            50% {
                opacity: .3;
            }
        }

        .setup-banner {
            background: var(--surface);
            border-bottom: 1px solid var(--line);
            padding: 10px 32px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
        }

        .setup-banner.hidden {
            display: none;
        }

        .setup-banner span {
            color: var(--sub);
        }

        .setup-modal {
            background: var(--surface);
            border: 1px solid var(--line);
            border-radius: 14px;
            width: 100%;
            max-width: 460px;
            padding: 28px;
        }

        .setup-modal h2 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .setup-modal p {
            font-size: 12px;
            color: var(--sub);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .setup-modal a {
            color: var(--acc);
        }

        .field {
            margin-bottom: 12px;
        }

        .field label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: .03em;
            text-transform: uppercase;
            color: var(--sub);
            margin-bottom: 6px;
        }

        .field input,
        .field textarea,
        .field select {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: 9px 12px;
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            outline: none;
            transition: border-color .15s;
        }

        .field input:focus,
        .field textarea:focus {
            border-color: var(--line2);
        }

        .field textarea {
            resize: vertical;
            min-height: 72px;
        }

        .action-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .del-btn {
            padding: 9px 16px;
            border-radius: var(--r);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            background: transparent;
            border: 1px solid var(--line2);
            color: var(--sub);
            transition: all .15s;
        }

        .del-btn:hover {
            color: #f87171;
            border-color: rgba(248, 113, 113, .4);
        }

        /* No ratings */
        .no-ratings {
            padding: 24px;
            text-align: center;
            color: var(--sub);
            font-size: 13px;
            border: 1px solid var(--line);
            border-radius: var(--r);
            margin-bottom: 20px;
        }

        /* Add modal */
        .add-modal {
            background: var(--surface);
            border: 1px solid var(--line);
            border-radius: 14px;
            width: 100%;
            max-width: 420px;
            padding: 28px;
        }

        .add-modal h2 {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: -.01em;
            margin-bottom: 4px;
        }

        .add-modal p {
            font-size: 12px;
            color: var(--sub);
            margin-bottom: 20px;
        }

        /* Empty state */
        .empty {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-icon {
            font-size: 40px;
            margin-bottom: 14px;
            opacity: .3;
        }

        .empty h3 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .empty p {
            font-size: 13px;
            color: var(--sub);
        }

        /* Toasts */
        .toast-wrap {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .toast {
            padding: 10px 14px;
            background: var(--surface);
            border: 1px solid var(--line2);
            border-radius: 8px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, .4);
            animation: toastin .2s ease;
            max-width: 280px;
        }

        @keyframes toastin {
            from {
                opacity: 0;
                transform: translateY(6px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Badges */
        .badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 2px 7px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: .04em;
            z-index: 2;
        }

        .b-new {
            background: var(--acc);
            color: #000;
        }

        .b-ep {
            background: rgba(255, 255, 255, .12);
            color: var(--text);
            backdrop-filter: blur(6px);
        }

        @media (max-width: 960px) {
            .sidebar {
                display: none;
            }
        }

        @media (max-width: 580px) {
            header {
                padding: 0 16px;
                gap: 12px;
            }

            main {
                padding: 24px 14px;
            }

            .grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 10px;
            }

            .d-top {
                flex-direction: column;
            }

            .d-poster,
            .d-poster-ph {
                width: 100%;
                height: 160px;
            }
        }

        /* â”€â”€ Login Screen â”€â”€ */
        #loginScreen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            font-family: 'Inter', sans-serif;
        }

        #loginScreen.hidden {
            display: none;
        }

        .login-bg {
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at 30% 20%, rgba(212, 168, 73, .12) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 80%, rgba(212, 168, 73, .07) 0%, transparent 55%);
            pointer-events: none;
        }

        .login-card {
            position: relative;
            background: #111111;
            border: 1px solid #1f1f1f;
            border-radius: 18px;
            padding: 44px 40px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 32px 80px rgba(0, 0, 0, .7), 0 0 0 1px rgba(255, 255, 255, .04) inset;
        }

        .login-logo {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -.02em;
            color: #ececec;
            margin-bottom: 6px;
        }

        .login-logo span {
            color: #d4a849;
        }

        .login-tagline {
            font-size: 12px;
            color: #6e6e6e;
            margin-bottom: 36px;
        }

        .login-field {
            margin-bottom: 16px;
        }

        .login-field label {
            display: block;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: .08em;
            text-transform: uppercase;
            color: #6e6e6e;
            margin-bottom: 7px;
        }

        .login-field input {
            width: 100%;
            background: #0d0d0d;
            border: 1px solid #222;
            border-radius: 10px;
            padding: 11px 14px;
            color: #ececec;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            outline: none;
            transition: border-color .2s, box-shadow .2s;
        }

        .login-field input:focus {
            border-color: rgba(212, 168, 73, .5);
            box-shadow: 0 0 0 3px rgba(212, 168, 73, .1);
        }

        .login-field input.error {
            border-color: rgba(248, 113, 113, .5);
            box-shadow: 0 0 0 3px rgba(248, 113, 113, .1);
            animation: shake .3s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-6px);
            }

            75% {
                transform: translateX(6px);
            }
        }

        .login-disclaimer {
            background: rgba(212, 168, 73, .06);
            border: 1px solid rgba(212, 168, 73, .18);
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 20px;
            margin-top: 4px;
        }

        .login-disclaimer-text {
            font-size: 11px;
            color: #7a7a7a;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .login-disclaimer-text strong {
            color: #a0a0a0;
        }

        .login-check-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
        }

        .login-check-row input[type="checkbox"] {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            accent-color: #d4a849;
            flex-shrink: 0;
            margin-top: 1px;
            cursor: pointer;
        }

        .login-check-label {
            font-size: 12px;
            color: #9a9a9a;
            line-height: 1.5;
            cursor: pointer;
            user-select: none;
        }

        .login-check-label strong {
            color: #d4a849;
        }

        .login-btn {
            width: 100%;
            padding: 13px;
            border-radius: 10px;
            background: #d4a849;
            color: #000;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: background .2s, transform .1s, box-shadow .2s;
            letter-spacing: .01em;
        }

        .login-btn:hover {
            background: #c49a38;
            box-shadow: 0 4px 16px rgba(212, 168, 73, .3);
        }

        .login-btn:active {
            transform: scale(.98);
        }

        .login-btn:disabled {
            opacity: .5;
            cursor: not-allowed;
        }

        .login-err {
            font-size: 12px;
            color: #f87171;
            margin-bottom: 12px;
            min-height: 18px;
            text-align: center;
        }

        .app-hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•  LOGIN SCREEN  â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="loginScreen">
        <div class="login-bg"></div>
        <div class="login-card">
            <div class="login-logo">Cine<span>Rate</span></div>
            <div class="login-tagline">Privater Film & Serien Tracker</div>

            <div class="login-field">
                <label>Dein Name (erscheint oben rechts)</label>
                <input type="text" id="loginName" placeholder="z.B. Chris" maxlength="25" autocomplete="nickname"
                    autocapitalize="words">
            </div>

            <div class="login-field">
                <label>Passwort</label>
                <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"
                    onkeydown="if(event.key==='Enter')doLogin()">
            </div>

            <div class="login-disclaimer">
                <div class="login-disclaimer-text">
                    <strong>âš  Datenschutz-Hinweis</strong><br>
                    Der Betreiber dieser Website Ã¼bernimmt <strong>keinerlei Haftung</strong> fÃ¼r datenschutzrechtliche
                    VerstÃ¶ÃŸe. Jeder Nutzer ist selbst dafÃ¼r verantwortlich, ausschlieÃŸlich Inhalte hochzuladen
                    und zu teilen, fÃ¼r die er die entsprechenden Rechte besitzt. Es dÃ¼rfen nur Inhalte
                    verwendet werden, die <strong>eigenes Eigentum</strong> sind oder fÃ¼r die eine
                    ausdrÃ¼ckliche Genehmigung vorliegt.
                </div>
                <label class="login-check-row">
                    <input type="checkbox" id="loginDisclaimer">
                    <span class="login-check-label">Ich habe den Hinweis gelesen und bestÃ¤tige, dass ich <strong>nur
                            eigene Inhalte</strong> hochladen werde. Mir ist bekannt, dass der Betreiber keine Haftung
                        Ã¼bernimmt.</span>
                </label>
            </div>

            <div class="login-err" id="loginErr"></div>
            <button class="login-btn" id="loginBtn" onclick="doLogin()">Einloggen â†’</button>
        </div>
    </div>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- App content â€“ hidden until login -->
    <div id="appRoot" class="app-hidden">

        <!-- HEADER -->
        <header>
            <div class="logo">Cine<span>Rate</span></div>
            <div class="type-switch">
                <button class="tt on" id="tabFilme" onclick="setType('filme')">Filme</button>
                <button class="tt" id="tabSerien" onclick="setType('serien')">Serien</button>
            </div>
            <div class="name-field" id="nameDisplay" style="display:flex;align-items:center;gap:8px;margin-left:auto;">
                <span id="headerNameLabel" style="font-size:13px;color:var(--sub)"></span>
                <div class="av" id="headerAv">?</div>
            </div>
            <div style="display:flex;align-items:center;gap:6px;margin-left:12px">
                <div class="sync-dot" id="syncDot"></div>
                <span style="font-size:11px;color:var(--sub)" id="syncText">lokal</span>
            </div>
            <button class="btn" style="padding:5px 12px;font-size:12px" onclick="openSetupModal()">âš™ Setup</button>
        </header>

        <!-- SETUP BANNER (shown when not configured) -->
        <div class="setup-banner" id="setupBanner">
            <span>ðŸ’¡ Verbinde eine JSONbin-Datenbank, um Daten mit Freunden zu teilen â€”</span>
            <button class="btn btn-primary" style="padding:5px 14px;font-size:12px" onclick="openSetupModal()">Jetzt
                einrichten</button>
            <button class="btn" style="padding:5px 10px;font-size:12px;margin-left:auto"
                onclick="dismissBanner()">âœ•</button>
        </div>

        <!-- JSONBIN SETUP OVERLAY -->
        <div class="overlay hidden" id="setupOv" onclick="if(event.target===this)this.classList.add('hidden')">
            <div class="setup-modal">
                <h2>Sync einrichten</h2>
                <p>Speichere Daten in einer kostenlosen <a href="https://jsonbin.io"
                        target="_blank">JSONbin.io</a>-Datenbank. Alle Freunde, die denselben Bin und Key verwenden,
                    sehen
                    dieselben Daten.<br><br><strong>Setup (einmalig):</strong><br>1. Account bei jsonbin.io
                    erstellen<br>2.
                    Neuen Bin anlegen, Inhalt: <code>{"filme":[],"serien":[]}</code><br>3. Master Key + Bin ID unten
                    eintragen</p>
                <div class="field"><label>Bin ID</label><input id="cfgBin" placeholder="64abc123..."></div>
                <div class="field"><label>Master Key</label><input id="cfgKey" type="password" placeholder="$2a$10$...">
                </div>
                <p style="font-size:11px;color:var(--sub);margin-top:-4px;margin-bottom:16px">Beide Werte werden nur
                    lokal
                    in deinem Browser gespeichert.</p>
                <div class="action-row">
                    <button class="btn btn-primary" onclick="saveSetup()">Verbinden &amp; laden</button>
                    <button class="btn"
                        onclick="document.getElementById('setupOv').classList.add('hidden')">Abbrechen</button>
                </div>
                <div style="margin-top:16px;border-top:1px solid var(--line);padding-top:14px">
                    <p style="font-size:11px;color:var(--sub);margin-bottom:8px">Bereits verbunden? Daten manuell
                        speichern
                        / laden:</p>
                    <div class="action-row">
                        <button class="btn" onclick="syncLoad(true)">â†“ Laden</button>
                        <button class="btn" onclick="syncSave(true)">â†‘ Speichern</button>
                        <button class="btn" style="color:#f87171;border-color:rgba(248,113,113,.3)"
                            onclick="clearSetup()">Verbindung trennen</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- DETAIL OVERLAY -->
        <div class="overlay hidden" id="detailOv" onclick="closeDetailClick(event)">
            <div class="detail-panel" id="detailPanel">
                <div class="d-top">
                    <div class="d-poster-ph" id="dPh">ðŸŽ¬</div>
                    <img id="dPoster" class="d-poster" src="" alt="" style="display:none">
                    <div class="d-info">
                        <div class="d-title" id="dTitle"></div>
                        <div class="d-meta" id="dMeta"></div>
                        <div class="d-genres" id="dGenres"></div>
                        <div class="d-ov" id="dOv"></div>
                        <button class="expand-btn" id="exBtn" onclick="toggleOv()">mehr â†“</button>
                    </div>
                    <button class="close-btn"
                        onclick="document.getElementById('detailOv').classList.add('hidden')">âœ•</button>
                </div>
                <div class="d-body">
                    <div class="section-label">Bewertungen</div>
                    <div id="avgArea"></div>
                    <div id="rList"></div>

                    <div class="add-box">
                        <h4>Deine Bewertung</h4>
                        <div class="star-picker" id="starPicker"></div>
                        <div class="field">
                            <label>Rezension (optional)</label>
                            <textarea id="revText" placeholder="Was dachtest du?"></textarea>
                        </div>
                        <div class="action-row">
                            <button class="btn btn-primary" onclick="submitRating()">Speichern</button>
                            <button class="del-btn" id="delBtn" style="display:none"
                                onclick="deleteRating()">LÃ¶schen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD OVERLAY -->
        <div class="overlay hidden" id="addOv" onclick="if(event.target===this)closeAddOv()">
            <div class="add-modal">
                <h2 id="addTitle">HinzufÃ¼gen</h2>
                <p>FÃ¼ge einen Titel manuell hinzu</p>
                <div class="field"><label>Titel *</label><input id="aTitle" placeholder="Titel"></div>
                <div style="display:flex;gap:10px">
                    <div class="field" style="flex:1"><label>Jahr</label><input id="aYear" maxlength="4"
                            placeholder="2024">
                    </div>
                    <div class="field" style="flex:1" id="aSeasonsWrap"><label>Staffeln</label><input id="aSeasons"
                            type="number" min="1" placeholder="3"></div>
                </div>
                <div class="field">
                    <label>Genres</label>
                    <div class="tag-picker-wrap" id="genrePickerWrap">
                        <div class="tag-picker-tags" id="genrePickerTags" onclick="toggleGenreDropdown(event)">
                            <span class="tag-placeholder" id="genrePlaceholder">Genre auswÃ¤hlenâ€¦</span>
                        </div>
                        <div class="tag-dropdown" id="genreDropdown"></div>
                    </div>
                </div>
                <div class="field"><label>Poster-URL</label><input id="aPoster" placeholder="https://..."></div>
                <div class="field"><label>Beschreibung</label><textarea id="aOv" placeholder="Optionalâ€¦"></textarea>
                </div>
                <div class="action-row">
                    <button class="btn btn-primary" onclick="addItem()">HinzufÃ¼gen</button>
                    <button class="btn" onclick="closeAddOv()">Abbrechen</button>
                </div>
            </div>
        </div>

        <div class="toast-wrap" id="toastWrap"></div>

        <main>
            <div class="stats" id="stats"></div>
            <div class="page-layout">
                <div class="main-col">
                    <div class="toolbar" style="margin-top:28px">
                        <div class="search-wrap">
                            <span class="search-icon">âŒ•</span>
                            <input id="searchI" type="text" placeholder="Suchenâ€¦" oninput="render()">
                        </div>
                        <select class="sort-sel" id="sortSel" onchange="setSort(this.value)">
                            <option value="recent">Neueste</option>
                            <option value="top">Top bewertet</option>
                            <option value="az">A â€“ Z</option>
                            <option value="raters">Meist bewertet</option>
                        </select>
                        <button class="btn btn-primary" onclick="openAdd()">+ HinzufÃ¼gen</button>
                    </div>
                    <div class="filter-row">
                        <select class="filter-sel" id="filterSel" onchange="setFilter(this.value)">
                            <option value="all">Alle Genres</option>
                        </select>
                    </div>
                    <div id="container"></div>
                </div>
                <div class="sidebar">
                    <div class="sidebar-card">
                        <div class="sidebar-hd">Zuletzt hinzugefÃ¼gt</div>
                        <div id="sidebarRecent"></div>
                    </div>
                    <div class="sidebar-card">
                        <div class="sidebar-hd">Top bewertet</div>
                        <div id="sidebarTop"></div>
                    </div>
                </div>
            </div>
        </main>

    </div><!-- /#appRoot -->

    <script>
        const PRESET_GENRES = {
            filme: ['Action', 'Abenteuer', 'Animation', 'Biografie', 'Drama', 'Fantasy', 'Horror', 'Historisch', 'KomÃ¶die', 'Krimi', 'Romanze', 'Sci-Fi', 'Thriller', 'Dokumentation'],
            serien: ['Action', 'Abenteuer', 'Animation', 'Drama', 'Fantasy', 'Horror', 'KomÃ¶die', 'Krimi', 'Sci-Fi', 'Thriller', 'Mystery', 'Dokumentation'],
        };

        /* â”€â”€ Login logic â”€â”€ */
        const LOGIN_PASSWORD = 'CS-Raffer';

        function doLogin() {
            const nameVal = document.getElementById('loginName').value.trim();
            const passVal = document.getElementById('loginPass').value;
            const checked = document.getElementById('loginDisclaimer').checked;
            const errEl = document.getElementById('loginErr');

            errEl.textContent = '';

            if (!nameVal) {
                document.getElementById('loginName').classList.add('error');
                setTimeout(() => document.getElementById('loginName').classList.remove('error'), 600);
                errEl.textContent = 'Bitte gib deinen Namen ein.';
                return;
            }
            if (!checked) {
                errEl.textContent = 'Bitte bestÃ¤tige den Datenschutz-Hinweis.';
                return;
            }
            if (passVal !== LOGIN_PASSWORD) {
                document.getElementById('loginPass').classList.add('error');
                setTimeout(() => document.getElementById('loginPass').classList.remove('error'), 600);
                errEl.textContent = 'Falsches Passwort.';
                document.getElementById('loginPass').value = '';
                document.getElementById('loginPass').focus();
                return;
            }

            // Success â€” persist session
            sessionStorage.setItem('cr_loggedIn', '1');
            sessionStorage.setItem('cr_sessionName', nameVal);
            localStorage.setItem('cr_name', nameVal);

            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appRoot').classList.remove('app-hidden');

            username = nameVal;
            updateAv();
        }

        // Check if already logged in this session
        (function checkSession() {
            const loggedIn = sessionStorage.getItem('cr_loggedIn');
            const savedName = sessionStorage.getItem('cr_sessionName') || localStorage.getItem('cr_name') || '';
            if (loggedIn === '1' && savedName) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appRoot').classList.remove('app-hidden');
                // username will be overwritten below when outer script runs
                // But we set the localStorage name so it picks it up
                localStorage.setItem('cr_name', savedName);
            } else {
                // Pre-fill name field if known
                if (savedName) document.getElementById('loginName').value = savedName;
            }
        })();

        const data = { filme: [], serien: [] };
        let type = 'filme', filter = 'all', sortBy = 'recent', current = null, stars = 0;
        let username = localStorage.getItem('cr_name') || '';
        const DEFAULT_BIN = '699b71c443b1c97be99495b7';
        const DEFAULT_KEY = '$2a$10$7jyNiQ97J51tdDZnnzXN1ODFwbW4C9z8rbBNZukEGInpEUpQk32KK';
        let BIN_ID = localStorage.getItem('cr_bin') || DEFAULT_BIN;
        let BIN_KEY = localStorage.getItem('cr_key') || DEFAULT_KEY;
        let synced = false;
        let selectedGenres = [];

        function avg(x) { if (!x.ratings.length) return 0; return x.ratings.reduce((s, r) => s + r.stars, 0) / x.ratings.length; }
        function esc(s) { return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'); }
        function fmtDate(d) { return new Date(d).toLocaleDateString('de-DE', { year: 'numeric', month: 'short', day: 'numeric' }); }
        function uColor(name) { let h = 0; for (let c of name) h = (h * 37 + c.charCodeAt(0)) % 360; return `hsl(${h},48%,46%)`; }
        function starsEl(n, size = 12) {
            return [1, 2, 3, 4, 5].map(i => {
                const fill = Math.min(Math.max(n - (i - 1), 0), 1) * 100;
                return `<span style="position:relative;display:inline-block;font-size:${size}px;line-height:1"><span style="color:var(--line2)">â˜…</span><span style="position:absolute;left:0;top:0;overflow:hidden;width:${fill}%;color:var(--acc)">â˜…</span></span>`;
            }).join('');
        }
        function toast(msg, ok = true) {
            const d = document.createElement('div'); d.className = 'toast';
            d.innerHTML = `<span>${ok ? 'âœ“' : 'âœ—'}</span><span>${msg}</span>`;
            document.getElementById('toastWrap').appendChild(d);
            setTimeout(() => d.remove(), 3500);
        }

        function setSyncUI(state) {
            const dot = document.getElementById('syncDot');
            const txt = document.getElementById('syncText');
            dot.className = 'sync-dot' + (state === 'ok' ? ' ok' : state === 'err' ? ' err' : state === 'busy' ? ' spin' : '');
            txt.textContent = state === 'ok' ? 'synced' : state === 'err' ? 'fehler' : state === 'busy' ? 'syncâ€¦' : 'lokal';
        }
        async function syncLoad(manual = false) {
            if (!BIN_ID || !BIN_KEY) return;
            setSyncUI('busy');
            try {
                const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { 'X-Access-Key': BIN_KEY } });
                if (!r.ok) throw new Error('HTTP ' + r.status);
                const j = await r.json();
                const d = j.record;
                if (d && Array.isArray(d.filme)) { data.filme = d.filme; data.serien = d.serien || []; }
                synced = true; setSyncUI('ok');
                render(); renderStats(); renderSidebar();
                if (manual) toast('Daten geladen âœ“');
            } catch (e) {
                setSyncUI('err');
                if (manual) toast('Laden fehlgeschlagen: ' + e.message, false);
            }
        }
        async function syncSave(manual = false) {
            if (!BIN_ID || !BIN_KEY) return;
            setSyncUI('busy');
            try {
                const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'X-Access-Key': BIN_KEY, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filme: data.filme, serien: data.serien })
                });
                if (!r.ok) throw new Error('HTTP ' + r.status);
                setSyncUI('ok');
                if (manual) toast('Gespeichert âœ“');
            } catch (e) {
                setSyncUI('err');
                if (manual) toast('Speichern fehlgeschlagen: ' + e.message, false);
            }
        }
        function openSetupModal() {
            document.getElementById('cfgBin').value = BIN_ID;
            document.getElementById('cfgKey').value = BIN_KEY;
            document.getElementById('setupOv').classList.remove('hidden');
        }
        function saveSetup() {
            BIN_ID = document.getElementById('cfgBin').value.trim();
            BIN_KEY = document.getElementById('cfgKey').value.trim();
            if (!BIN_ID || !BIN_KEY) { toast('Bin ID und Key erforderlich', false); return; }
            localStorage.setItem('cr_bin', BIN_ID);
            localStorage.setItem('cr_key', BIN_KEY);
            document.getElementById('setupOv').classList.add('hidden');
            document.getElementById('setupBanner').classList.add('hidden');
            syncLoad(true);
        }
        function clearSetup() {
            if (!confirm('Verbindung wirklich trennen? Lokale Daten bleiben.')) return;
            BIN_ID = ''; BIN_KEY = '';
            localStorage.removeItem('cr_bin'); localStorage.removeItem('cr_key');
            setSyncUI('local'); synced = false;
            document.getElementById('setupOv').classList.add('hidden');
            toast('Verbindung getrennt');
        }
        function dismissBanner() { document.getElementById('setupBanner').classList.add('hidden'); }

        window.addEventListener('DOMContentLoaded', () => {
            updateAv();
            document.getElementById('setupBanner').classList.add('hidden');
            syncLoad();
            render(); renderStats(); renderSidebar();
        });

        document.addEventListener('click', e => {
            const dd = document.getElementById('genreDropdown');
            const wrap = document.getElementById('genrePickerWrap');
            if (dd && wrap && !wrap.contains(e.target)) dd.classList.remove('open');
        });

        function onNameChange() {
            username = document.getElementById('nameInput').value.trim();
            localStorage.setItem('cr_name', username);
            updateAv();
        }
        function updateAv() {
            const av = document.getElementById('headerAv');
            av.textContent = username ? username[0].toUpperCase() : '?';
            av.style.background = username ? uColor(username) : 'var(--acc)';
            const lbl = document.getElementById('headerNameLabel');
            if (lbl) lbl.textContent = username || '';
        }

        function setType(t) {
            type = t; filter = 'all';
            document.getElementById('tabFilme').classList.toggle('on', t === 'filme');
            document.getElementById('tabSerien').classList.toggle('on', t === 'serien');
            render(); renderStats();
        }

        function setSort(v) { sortBy = v; render(); }
        function setFilter(v) { filter = v; render(); }

        function renderStats() {
            const list = data[type];
            const totalR = list.reduce((s, x) => s + x.ratings.length, 0);
            const myR = list.reduce((s, x) => s + x.ratings.filter(r => r.user === username).length, 0);
            const avgs = list.filter(x => x.ratings.length).map(avg);
            const ga = avgs.length ? (avgs.reduce((a, b) => a + b, 0) / avgs.length).toFixed(1) : 'â€”';
            document.getElementById('stats').innerHTML = [
                { v: list.length, l: type === 'filme' ? 'Filme' : 'Serien' },
                { v: totalR, l: 'Bewertungen' },
                { v: myR, l: 'Meine' },
                { v: ga, l: 'âŒ€ Score' },
            ].map(s => `<div class="stat"><div class="stat-v">${s.v}</div><div class="stat-l">${s.l}</div></div>`).join('');
        }

        function render() {
            const q = (document.getElementById('searchI').value || '').toLowerCase();
            let list = data[type].filter(x =>
                x.title.toLowerCase().includes(q) || (x.genres || []).some(g => g.toLowerCase().includes(q))
            );
            if (filter !== 'all') list = list.filter(x => (x.genres || []).includes(filter));

            const dataGenres = new Set(data[type].flatMap(x => x.genres || []));
            const genres = [...new Set([...PRESET_GENRES[type], ...dataGenres])];
            const filterSel = document.getElementById('filterSel');
            if (filterSel) {
                filterSel.innerHTML = `<option value="all"${filter === 'all' ? ' selected' : ''}>Alle Genres</option>`
                    + genres.map(g => `<option value="${esc(g)}"${filter === g ? ' selected' : ''}>${esc(g)}</option>`).join('');
            }

            if (sortBy === 'top') list.sort((a, b) => avg(b) - avg(a));
            else if (sortBy === 'az') list.sort((a, b) => a.title.localeCompare(b.title));
            else if (sortBy === 'raters') list.sort((a, b) => b.ratings.length - a.ratings.length);
            else list.sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt));

            const c = document.getElementById('container');
            if (!list.length) {
                c.innerHTML = `<div class="empty"><div class="empty-icon">${type === 'filme' ? 'ðŸŽ¬' : 'ðŸ“º'}</div><h3>Keine Treffer</h3><p>FÃ¼ge deinen ersten Titel hinzu.</p></div>`;
                return;
            }
            c.innerHTML = `<div class="grid">${list.map(cardHtml).join('')}</div>`;
        }

        function renderSidebar() {
            const all = [...data.filme, ...data.serien];

            const recent = [...all].sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt)).slice(0, 5);
            document.getElementById('sidebarRecent').innerHTML = recent.length
                ? recent.map((x, i) => sbItemHtml(x, i + 1, false)).join('')
                : '<div style="padding:14px;font-size:12px;color:var(--sub)">Noch keine EintrÃ¤ge</div>';

            const top = [...all].filter(x => x.ratings.length > 0).sort((a, b) => avg(b) - avg(a)).slice(0, 5);
            document.getElementById('sidebarTop').innerHTML = top.length
                ? top.map((x, i) => sbItemHtml(x, i + 1, true)).join('')
                : '<div style="padding:14px;font-size:12px;color:var(--sub)">Noch keine Bewertungen</div>';
        }

        function sbItemHtml(x, rank, showScore) {
            const a = avg(x);
            const thumb = x.poster
                ? `<img class="sb-thumb" src="${esc(x.poster)}" alt="" loading="lazy">`
                : `<div class="sb-thumb-ph">${x.type === 'serien' ? 'ðŸ“º' : 'ðŸŽ¬'}</div>`;
            return `<div class="sb-item" onclick="openDetail('${x.id}')">
                <span class="sb-rank">${rank}</span>
                ${thumb}
                <div class="sb-info">
                    <div class="sb-title" title="${esc(x.title)}">${esc(x.title)}</div>
                    <div class="sb-sub">${x.year || 'â€”'}${x.type === 'serien' ? ' Â· Serie' : ' Â· Film'}</div>
                </div>
                ${showScore && a > 0 ? `<span class="sb-score">â˜… ${a.toFixed(1)}</span>` : ''}
            </div>`;
        }

        function cardHtml(x) {
            const a = avg(x);
            const isNew = (Date.now() - new Date(x.addedAt)) < 86400000 * 4;
            const dots = x.ratings.slice(0, 4).map(r => `<div class="rater-dot" title="${r.user}" style="background:${uColor(r.user)}">${r.user[0]}</div>`).join('');
            return `<div class="card" onclick="openDetail('${x.id}')">
    <div class="poster-wrap">
      ${isNew ? `<div class="badge b-new">NEU</div>` : ''}
      ${x.seasons ? `<div class="badge b-ep" style="${isNew ? 'top:32px' : 'top:8px'}">${x.seasons}S</div>` : ''}
      ${x.poster ? `<img src="${esc(x.poster)}" loading="lazy" alt="${esc(x.title)}">` : `<div class="poster-placeholder">${x.type === 'serien' ? 'ðŸ“º' : 'ðŸŽ¬'}</div>`}
    </div>
    <div class="card-body">
      <div class="card-title" title="${esc(x.title)}">${esc(x.title)}</div>
      <div class="card-sub">${x.year || ''}${x.runtime ? ' Â· ' + x.runtime + ' min' : x.seasons ? ' Â· ' + x.seasons + ' Staffeln' : ''}</div>
      <div class="card-meta">
        ${a > 0 ? `<div class="score"><span class="score-star">â˜…</span>${a.toFixed(1)}</div>` : `<span style="font-size:11px;color:var(--sub)">â€”</span>`}
        <div class="rater-row">${dots}</div>
        ${x.ratings.length > 4 ? `<span style="font-size:10px;color:var(--sub)">+${x.ratings.length - 4}</span>` : ''}
      </div>
    </div>
  </div>`;
        }

        function openDetail(id) {
            const item = data[type].find(x => x.id === id) || data.filme.find(x => x.id === id) || data.serien.find(x => x.id === id);
            if (!item) return;
            current = item; stars = 0;
            document.getElementById('detailOv').classList.remove('hidden');
            document.getElementById('dTitle').textContent = item.title;
            document.getElementById('dMeta').textContent = [item.year, item.runtime ? item.runtime + ' min' : '', item.seasons ? item.seasons + ' Staffeln' : ''].filter(Boolean).join(' Â· ');
            document.getElementById('dGenres').innerHTML = (item.genres || []).map(g => `<span class="g-pill">${esc(g)}</span>`).join('');
            const ov = document.getElementById('dOv');
            ov.textContent = item.overview || 'Keine Beschreibung.';
            ov.classList.remove('exp');
            document.getElementById('exBtn').textContent = 'mehr â†“';
            if (item.poster) {
                document.getElementById('dPoster').src = item.poster;
                document.getElementById('dPoster').style.display = '';
                document.getElementById('dPh').style.display = 'none';
            } else {
                document.getElementById('dPoster').style.display = 'none';
                document.getElementById('dPh').style.display = '';
                document.getElementById('dPh').textContent = item.type === 'serien' ? 'ðŸ“º' : 'ðŸŽ¬';
            }
            const my = item.ratings.find(r => r.user === username);
            stars = my ? my.stars : 0;
            document.getElementById('revText').value = my ? my.review || '' : '';
            document.getElementById('delBtn').style.display = my ? '' : 'none';
            renderPicker(); renderDetailRatings(item);
        }

        function closeDetailClick(e) { if (e.target === document.getElementById('detailOv')) document.getElementById('detailOv').classList.add('hidden'); }
        function toggleOv() { const o = document.getElementById('dOv'); o.classList.toggle('exp'); document.getElementById('exBtn').textContent = o.classList.contains('exp') ? 'weniger â†‘' : 'mehr â†“'; }

        function renderDetailRatings(item) {
            const a = avg(item);
            if (!item.ratings.length) {
                document.getElementById('avgArea').innerHTML = '';
                document.getElementById('rList').innerHTML = `<div class="no-ratings">Noch keine Bewertungen â€” sei der Erste!</div>`;
                return;
            }
            document.getElementById('avgArea').innerHTML = `<div class="avg-row">
    <div><div class="avg-num">${a.toFixed(1)}</div><div class="avg-stars">${starsEl(a, 14)}</div><div class="avg-count">${item.ratings.length} Bewertung${item.ratings.length > 1 ? 'en' : ''}</div></div>
    <div class="bar-list">${[5, 4, 3, 2, 1].map(s => { const cnt = item.ratings.filter(r => r.stars === s).length; const p = item.ratings.length ? cnt / item.ratings.length * 100 : 0; return `<div class="bar-row"><span class="bar-label">${s}</span><div class="bar-track"><div class="bar-fill" style="width:${p}%"></div></div><span class="bar-count">${cnt}</span></div>`; }).join('')}</div>
  </div>`;
            document.getElementById('rList').innerHTML = `<div class="r-list">${item.ratings.map(r => `<div class="r-entry">
    <div class="r-av" style="background:${uColor(r.user)}">${r.user[0].toUpperCase()}</div>
    <div style="flex:1">
      <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
        <span class="r-name">${esc(r.user)}</span>
        <div class="r-stars">${starsEl(r.stars)}</div>
        <span style="font-size:11px;color:var(--sub)">${r.stars}/5</span>
      </div>
      <div class="r-date">${fmtDate(r.date)}</div>
      ${r.review ? `<div class="r-review">${esc(r.review)}</div>` : ''}
    </div>
  </div>`).join('')}</div>`;
        }

        function renderPicker() {
            const el = document.getElementById('starPicker');
            el.innerHTML = [1, 2, 3, 4, 5].map(i => {
                const fillW = Math.min(Math.max(stars - (i - 1), 0), 1) * 100;
                return `<div class="star-slot" data-i="${i}"><div class="s-bg">â˜…</div><div class="s-fill" style="width:${fillW}%">â˜…</div><div class="s-left" onmousemove="hoverHalf(${i},true)" onclick="pickHalf(${i},true)"></div><div class="s-right" onmousemove="hoverHalf(${i},false)" onclick="pickHalf(${i},false)"></div></div>`;
            }).join('');
            el.onmouseleave = () => renderPicker();
        }
        function pickHalf(i, isLeft) { stars = isLeft ? i - 0.5 : i; renderPicker(); }
        function hoverHalf(i, isLeft) {
            const val = isLeft ? i - 0.5 : i;
            document.querySelectorAll('#starPicker .star-slot').forEach(slot => {
                const si = parseInt(slot.dataset.i);
                slot.querySelector('.s-fill').style.width = Math.min(Math.max(val - (si - 1), 0), 1) * 100 + '%';
            });
        }

        function submitRating() {
            if (!username) { toast('Gib bitte deinen Namen ein (oben rechts)', false); return; }
            if (!stars) { toast('Bitte wÃ¤hle eine Wertung', false); return; }
            const rev = document.getElementById('revText').value.trim();
            current.ratings = current.ratings.filter(r => r.user !== username);
            current.ratings.push({ user: username, stars, review: rev, date: new Date().toISOString() });
            document.getElementById('delBtn').style.display = '';
            renderDetailRatings(current); renderStats(); render(); renderSidebar();
            syncSave();
            toast('Bewertung gespeichert');
        }
        function deleteRating() {
            if (!confirm('Deine Bewertung wirklich lÃ¶schen?')) return;
            current.ratings = current.ratings.filter(r => r.user !== username);
            stars = 0;
            document.getElementById('revText').value = '';
            document.getElementById('delBtn').style.display = 'none';
            renderPicker(); renderDetailRatings(current); renderStats(); render(); renderSidebar();
            syncSave();
            toast('Bewertung gelÃ¶scht');
        }

        function toggleGenreDropdown(e) {
            e.stopPropagation();
            document.getElementById('genreDropdown').classList.toggle('open');
        }

        function buildGenreDropdown() {
            const genres = PRESET_GENRES[type];
            const dd = document.getElementById('genreDropdown');
            dd.innerHTML = genres.map(g => {
                const sel = selectedGenres.includes(g);
                return `<div class="tag-opt${sel ? ' sel' : ''}" onclick="toggleGenre('${g}', event)">${g}</div>`;
            }).join('');
        }

        function toggleGenre(g, e) {
            e.stopPropagation();
            if (selectedGenres.includes(g)) {
                selectedGenres = selectedGenres.filter(x => x !== g);
            } else {
                selectedGenres.push(g);
            }
            buildGenreDropdown();
            renderGenreTags();
        }

        function removeGenre(g) {
            selectedGenres = selectedGenres.filter(x => x !== g);
            buildGenreDropdown();
            renderGenreTags();
        }

        function renderGenreTags() {
            const container = document.getElementById('genrePickerTags');
            const ph = document.getElementById('genrePlaceholder');
            if (selectedGenres.length === 0) {
                container.innerHTML = '';
                const span = document.createElement('span');
                span.className = 'tag-placeholder';
                span.id = 'genrePlaceholder';
                span.textContent = 'Genre auswÃ¤hlenâ€¦';
                container.appendChild(span);
            } else {
                container.innerHTML = selectedGenres.map(g =>
                    `<span class="tag-pill">${esc(g)}<button onclick="removeGenre('${g}');event.stopPropagation()" title="Entfernen">âœ•</button></span>`
                ).join('');
            }
        }

        function openAdd() {
            document.getElementById('addTitle').textContent = type === 'filme' ? 'Film hinzufÃ¼gen' : 'Serie hinzufÃ¼gen';
            document.getElementById('aSeasonsWrap').style.display = type === 'serien' ? '' : 'none';
            selectedGenres = [];
            buildGenreDropdown();
            renderGenreTags();
            document.getElementById('addOv').classList.remove('hidden');
        }

        function closeAddOv() {
            document.getElementById('addOv').classList.add('hidden');
            document.getElementById('genreDropdown').classList.remove('open');
        }

        function addItem() {
            const title = document.getElementById('aTitle').value.trim();
            if (!title) { toast('Titel ist erforderlich', false); return; }
            const year = document.getElementById('aYear').value.trim();
            const dup = data[type].find(x => x.title.toLowerCase() === title.toLowerCase());
            if (dup) { toast('Titel existiert bereits'); closeAddOv(); openDetail(dup.id); return; }
            const item = {
                id: type[0] + Date.now(), type, title, year,
                genres: [...selectedGenres],
                poster: document.getElementById('aPoster').value.trim(),
                overview: document.getElementById('aOv').value.trim(),
                runtime: 0, seasons: parseInt(document.getElementById('aSeasons').value) || 0,
                addedAt: new Date().toISOString(), ratings: []
            };
            data[type].push(item);
            closeAddOv();
            ['aTitle', 'aYear', 'aPoster', 'aOv'].forEach(id => document.getElementById(id).value = '');
            selectedGenres = [];
            render(); renderStats(); renderSidebar(); openDetail(item.id);
            syncSave();
            toast(`${title} hinzugefÃ¼gt`);
        }
    </script>
</body>

</html>
